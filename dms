#!/bin/bash
# Simple dmenu search tool

keywords=("google" "yt" "kat" "aur" "imdb" "duck" "felirat" "rarbg" "open" "~" "/")
hist_file=/tmp/dms_hist

_open(){

    xdg-open $1

}

_keywords(){

    for i in ${keywords[@]}; do
        echo $i
    done
}

dmenu_keywords=$(_keywords | dmenu -l 5 -i -fn 'monospace-12' )

search=$(echo $dmenu_keywords | awk '{ if ($1 ~ /(google|yt|kat|imdb|duck|felirat|rarbg|open)/) {$1="" ; gsub(" ","+")} else if ($1 ~ aur) {$1=""; gsub(" ","")}; print $0}')

#echo $search

if [[ $dmenu_keywords != "/" ]] && ! grep -q "$dmenu_keywords" "$hist_file"; then
    echo $dmenu_keywords >> $hist_file
fi

case $dmenu_keywords in

    google*) # Search on Google

        _open "https://www.google.com/search?q="$search""
        ;;

    yt*) # Search on Youtube

        _open "https://www.youtube.com/results?search_query="$search""
        ;;

    kat*) # Search on Kickass Torrents

        _open "https://kat.cr/usearch/?q="$search""
        ;;

    imdb*) # Search on IMDb

        _open "http://www.imdb.com/find?ref_=nv_sr_fn&q="$search"&s=all"
        ;;

    duck*) # Search on DuckDuckGo

        _open "https://duckduckgo.com/?q="$search""
        ;;

    felirat*) # Search on feliratok.hu

        _open "http://feliratok.info/?search="$search""
        ;;

    rarbg*) # Search on rarbg

        _open "https://rarbg.to/torrents.php?search="$search""
        ;;

    aur*) # Search on Arch User Repository

        _open "https://www.archlinux.org/packages/?sort=&q="$search"&maintainer=&flagged="
        ;;


    ~*) # Search local files in home directory and copy selected path to clipboard
        search_result=$(sed -e s"/~//" <<< $dmenu_keywords)
        find ~ -iname $search_result\* | dmenu -l 10 -i -fn 'monospace-12' | xsel -b
        ;;


    open*) # Search local files in home directory and open selected one with default application
        search_result=$(sed -e s"/open//" <<< $dmenu_keywords)
        selected_result=$(find ~ -iname $search_result\* | dmenu -l 10 -i -fn 'monospace-12')
        xdg-open $selected_result
        ;;

    /*) selected_history_element=$(tac $hist_file | dmenu -l 10 -i -fn 'monospace-12')
        #echo $selected_history_element
        ;;

    *) # if no search engine selected, then search automatically on google
        if [[ $dmenu_keywords != "" ]];then

            search_text=$(sed -e "s/\s/+/g" <<< $dmenu_keywords)

           _open "https://www.google.com/search?q="$search_text""

       else
               :

       fi
        ;;

esac
